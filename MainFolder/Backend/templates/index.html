<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload e Texto</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f7f7f7;
        height: 100vh;
        display: grid;
        place-items: center;
      }
      .card {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
        width: 350px;
      }
      .row {
        margin: 10px 0;
        display: flex;
        flex-direction: column;
      }
      textarea {
        width: 100%;
        height: 80px;
      }
      .ok {
        color: #0a7b28;
      }
      .err {
        color: #b00020;
      }
      .hidden {
        display: none;
      }
      select {
        margin-bottom: 15px;
        padding: 5px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>Upload ou Texto</h2>
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="row">
          <label for="inputType">Selecione o tipo de entrada:</label>
          <select id="inputType" name="inputType">
            <option value="file">Arquivo</option>
            <option value="text">Texto</option>
          </select>
        </div>

        <div class="row" id="fileDiv">
          <label for="fileInput">Arquivo:</label>
          <input
            type="file"
            name="file"
            id="fileInput"
            accept=".jpg,.png,.pdf,.csv"
          />
        </div>

        <div class="row hidden" id="textDiv">
          <label for="textInput">Texto:</label>
          <textarea
            name="text"
            id="textInput"
            placeholder="Digite aqui..."
          ></textarea>
        </div>

        <div class="row">
          <button type="submit" id="submitBtn">Enviar</button>
        </div>
        <p id="status"></p>
      </form>
    </div>

    <script>
      const form = document.getElementById("uploadForm");
      const statusText = document.getElementById("status");
      const inputType = document.getElementById("inputType");
      const fileDiv = document.getElementById("fileDiv");
      const textDiv = document.getElementById("textDiv");

      // Alterna entre os campos de entrada
      inputType.addEventListener("change", () => {
        if (inputType.value === "file") {
          fileDiv.classList.remove("hidden");
          textDiv.classList.add("hidden");
        } else {
          fileDiv.classList.add("hidden");
          textDiv.classList.remove("hidden");
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData();

        if (inputType.value === "file") {
          const file = document.getElementById("fileInput").files[0];
          if (!file) {
            statusText.textContent = "Selecione um arquivo!";
            statusText.className = "err";
            return;
          }
          formData.append("file", file);
        } else {
          const text = document.getElementById("textInput").value.trim();
          if (!text) {
            statusText.textContent = "Digite algum texto!";
            statusText.className = "err";
            return;
          }
          formData.append("text", text);
        }

        await sendData(formData);
      });

      async function sendData(formData) {
        statusText.textContent = "Enviando...";
        statusText.className = "";

        try {
          const resp = await fetch("/upload", {
            method: "POST",
            body: formData,
          });
          const result = await resp.json();
          statusText.textContent = result.message;
          statusText.className = resp.ok ? "ok" : "err";
        } catch {
          statusText.textContent = "Erro no envio!";
          statusText.className = "err";
        }
      }
    </script>
  </body>
</html>
